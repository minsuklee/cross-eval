# PRD: 수업 과제 상호평가(Cross-Evaluation) 시스템 v2.0

## 1. 개요

### 1.1 목적
대학 수업에서 학생들이 제출한 과제를 학생 간 상호평가(peer review)할 수 있는 서버리스 웹 시스템을 구축한다. **v2.0에서는 한 명의 교수가 여러 과목을 운영할 수 있도록 다중 과목 지원이 추가되었으며**, 각 과목은 독립적인 Google Spreadsheet에 저장된다. 프론트엔드는 GitHub Pages에서 정적 JavaScript로 동작한다.

### 1.2 기술 스택
| 구성요소 | 기술 |
|---------|------|
| 프론트엔드 | GitHub Pages (정적 HTML/CSS/JS) |
| 백엔드 API | Google Apps Script (Web App으로 배포) |
| 데이터 저장소 | Google Spreadsheet (**과목별 1개** + 마스터 1개) |
| 과제 수집 | ~~Google Forms → Google Sheets 연동~~ → **학생이 직접 링크 제출** |
| 인증 | 자체 비밀번호 (SHA-256 해싱 저장, 시트 기반 비교) |
| 엑셀 파싱 | SheetJS/xlsx 라이브러리 (프론트엔드) |

### 1.3 사용자
| 역할 | 설명 |
|------|------|
| 교수 | **과목 생성**, 학생 등록(엑셀 업로드), 과제 출제, 상호평가 시작/종료, 교수 평가 입력 |
| 학생 | **과제 링크 제출**, 상호평가 수행(익명), 결과 확인 |

### 1.4 v1.0 대비 주요 변경점 (v2.0)
| 영역 | v1.0 | v2.0 |
|------|------|------|
| 과목 관리 | 단일 스프레드시트 | **다중 과목 지원** (과목별 스프레드시트 자동 생성) |
| 교수 비밀번호 | `_config` 시트에 고정 | **초기 비밀번호 `minsuk615`**, 빈 필드일 때 허용, 변경 가능 |
| 학생 등록 | 탭 구분 텍스트 | **엑셀 파일 업로드** (학번, 이름만) |
| 과제 수집 | Google Forms → Sheets 연동 | **학생이 직접 링크 제출** (구글 드라이브 공유 링크 등) |
| 과제 상태 | 대기→제출중→평가중→평가완료→확정 | **제출중→평가중→평가완료→확정** (마감 전 평가 시작 가능) |
| 상호평가 표시 | 실명 | **익명 (학생1, 학생2 등)** |
| 평가자 수 | 고정 2명 | **2~3명** (제출자 수에 따라 유동적) |
| 결과 표시 | 점수만 | 평가자별 **점수 + 서술평 + 교수 평가** (최대 3명) |
| 학생_마스터 | 학번, 이름, 비밀번호 | **학번, 이름, 비밀번호** |

### 1.5 제약 조건
- 별도 서버 없음 (Google Apps Script + GitHub Pages만 사용)
- **마스터 스프레드시트 1개** + **과목별 스프레드시트** (과목 수만큼 생성)
- 학생은 모두 `@kookmin.ac.kr` 도메인 Google 계정 보유
- Google Apps Script 일일 실행 한도: 일반 계정 20,000회, Workspace 계정 100,000회
- Apps Script 단일 실행 시간 제한: 6분

---

## 2. 시스템 아키텍처

```
┌─────────────────┐     HTTPS (fetch, text/plain)     ┌──────────────────────┐
│  GitHub Pages   │ ◄──────────────────────────────► │  Google Apps Script  │
│  (프론트엔드)     │                                   │  (Web App - API)     │
│  - 학생 UI       │                                   │  - doGet() / doPost()│
│  - 교수 UI       │                                   │  - 비즈니스 로직       │
│  - SheetJS 파싱  │                                   │  - 과목 관리          │
└─────────────────┘                                   └──────────┬───────────┘
                                                                 │
                                                      ┌──────────▼──────────┐
                                                      │  마스터 스프레드시트   │
                                                      │  - 과목_목록          │
                                                      │  - 글로벌 설정        │
                                                      └──────────┬──────────┘
                                                                 │
                                               ┌─────────────────┼─────────────────┐
                                               ▼                 ▼                 ▼
                                    ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
                                    │  과목1 시트    │  │  과목2 시트    │  │  과목N 시트    │
                                    │  - _config    │  │  - _config    │  │  - _config    │
                                    │  - 학생_마스터  │  │  - 학생_마스터  │  │  - 학생_마스터  │
                                    │  - 과제_목록   │  │  - 과제_목록   │  │  - 과제_목록   │
                                    │  - 제출_A{n}  │  │  - 제출_A{n}  │  │  - 제출_A{n}  │
                                    │  - 평가_A{n}  │  │  - 평가_A{n}  │  │  - 평가_A{n}  │
                                    └──────────────┘  └──────────────┘  └──────────────┘
```

### 2.1 통신 방식
- GitHub Pages → Apps Script: `fetch()` with `Content-Type: text/plain` (CORS preflight 회피)
- 요청/응답 형식: JSON 문자열 (text/plain으로 전송)
- Apps Script → Sheets: `SpreadsheetApp` 내장 API

---

## 3. Google Spreadsheet 구조 설계

### 3.1 마스터 스프레드시트

교수의 Apps Script 프로젝트에 바인딩된 마스터 스프레드시트. 글로벌 설정과 과목 목록**만** 관리한다.

> **중요**: 마스터 스프레드시트에는 `_config`와 `과목_목록` 시트만 존재해야 한다. **학생_마스터, 과제_목록, 평가배정, 결과 등 과목별 데이터는 절대 마스터 시트에 저장하지 않는다.** 모든 과목별 데이터는 반드시 해당 과목의 별도 스프레드시트에 저장된다. `courseId`가 null/빈 값인 요청은 백엔드에서 즉시 에러를 반환한다 (마스터 시트로 fallback하지 않는다).

#### 시트: `_config` (글로벌 설정)

> **자동 생성**: 이 시트가 존재하지 않으면 최초 API 호출 시 자동으로 생성된다. 교수가 별도로 시트를 만들 필요 없음.

| 열 | 내용 |
|----|------|
| A | 설정 키 |
| B | 설정 값 |

저장 항목:
- `admin_password`: 교수 관리자 비밀번호 (SHA-256 해싱 저장). **빈 값이면 초기 비밀번호 `minsuk615` 허용**
- `system_name`: 시스템 이름 (기본값: "상호평가 시스템")

#### 시트: `과목_목록`

> **자동 생성**: 이 시트가 존재하지 않으면 과목 생성/조회 시 자동으로 생성된다.

| 열 | 필드명 | 설명 |
|----|--------|------|
| A | 과목ID | 자동 생성 (C1, C2, ...) |
| B | 과목명 | |
| C | 년도 | 예: 2026 |
| D | 학기 | `1` / `2` / `summer` / `winter` |
| E | 스프레드시트ID | 생성된 과목별 Google Sheets의 ID |
| F | 생성일시 | |
| G | 상태 | `활성` / `삭제됨` (기본값: `활성`) |

### 3.2 과목별 스프레드시트 (과목당 1개씩 자동 생성)

#### 명명 규칙
```
CrossEval-{연도}-{학기코드}-{과목이름}
```
- 학기코드: `1` / `2` / `summer` / `winter`
- 예시: `CrossEval-2026-1-소프트웨어공학개론`

#### 시트 1: `_config`

| 열 | 내용 |
|----|------|
| A | 설정 키 |
| B | 설정 값 |

저장 항목:
- `course_name`: 과목명
- `year`: 년도
- `semester`: 학기
- `created_at`: 생성 시각

#### 시트 2: `학생_마스터`

| 열 | 필드명 | 설명 |
|----|--------|------|
| A | 학번 | Primary Key |
| B | 이름 | |
| C | 비밀번호 | SHA-256 해싱 저장 (최초 로그인 시 설정, 빈 값이면 미설정) |
| D~ | 과제1_최종점수, 과제2_최종점수, ... | 교수가 확정한 최종 점수 (동적 추가) |

> 학번과 이름만 관리. 교수가 **엑셀 파일 업로드**로 일괄 등록.

#### 시트 3: `과제_목록`

| 열 | 필드명 | 설명 |
|----|--------|------|
| A | 과제ID | 과제1, 과제2, ... |
| B | 과제명 | |
| C | 과제설명 | |
| D | 제출마감일시 | |
| E | 평가마감일시 | 상호평가 시작 시 교수가 설정 |
| F | 상태 | `제출중` / `평가중` / `평가완료` / `확정` |
| G | 채점기준_설명 | 학생에게 보여줄 채점 기준 |
| H | 최소점수 | 채점 범위 하한 (예: 0) |
| I | 최대점수 | 채점 범위 상한 (예: 100) |
| J | 교수평가여부 | `Y` / `N` (기본값: `N`). 교수가 직접 평가할 과제인지 여부 |

> **v2.0 변경**: `Google_Form_URL` 컬럼 제거 (Google Form 사용하지 않음). 상태에서 `대기` 제거 (생성 즉시 `제출중`).
> **v2.2 변경**: `교수평가여부` 컬럼 추가. 과제 생성 시 교수가 직접 평가할지 여부를 설정.

#### 시트 4~N: `제출_A{n}` (과제별 1개씩 생성)

| 열 | 필드명 | 설명 |
|----|--------|------|
| A | 학번 | 제출 학생 |
| B | 제출링크 | 과제 공유 링크 (구글 드라이브 등) |
| C | 제출시각 | 타임스탬프 |

> 학생이 프론트엔드에서 직접 링크를 입력하여 제출. 학번, 제출링크, 제출시각으로 구성. 동일 학번이 다시 제출하면 기존 행을 **덮어쓰기**(최신 제출로 갱신).

#### 시트 4~N+1: `평가_A{n}` (과제별 1개씩 생성)

| 열 | 필드명 | 설명 |
|----|--------|------|
| A | 피평가자_학번 | 평가 대상 학생 (학생별 1행) |
| B | 평가자1_학번 | 첫 번째 평가자 |
| C | 점수1 | 평가자1의 점수 (빈칸→미완료) |
| D | 서술평1 | 평가자1의 서술평 |
| E | 평가1_완료시각 | |
| F | 평가자2_학번 | 두 번째 평가자 |
| G | 점수2 | |
| H | 서술평2 | |
| I | 평가2_완료시각 | |
| J | 평가자3_학번 | 세 번째 평가자 (없으면 빈 값) |
| K | 점수3 | (없으면 빈 값) |
| L | 서술평3 | (없으면 빈 값) |
| M | 평가3_완료시각 | (없으면 빈 값) |
| N | 교수_점수 | |
| O | 교수_서술평 | |

> **v2.0 변경**: v1.0의 `과제N_평가배정` + `과제N_결과`를 **하나의 `평가_A{n}` 시트로 통합**. 피평가자 기준 1행으로 관리. 평가자가 2명인 경우 평가자3/점수3/서술평3 컬럼은 빈 값으로 유지.

---

## 4. 사용자 플로우 상세

### 4.1 교수 비밀번호 체계

#### 초기 비밀번호 로직
```
교수 → 로그인 시도
  → 마스터 스프레드시트 _config에서 admin_password 조회
  → [admin_password가 빈 값] → 초기 비밀번호 'minsuk615'로 비교
    → 일치 시 → 비밀번호 변경 강제 화면
    → 새 비밀번호 입력 → SHA-256 해싱 후 시트에 저장
  → [admin_password에 값이 있음] → 입력값 SHA-256 해싱 후 비교
    → 일치 시 → 교수 대시보드
```

#### 비밀번호 변경
- 교수 대시보드 설정에서 언제든 비밀번호 변경 가능
- 현재 비밀번호 확인 → 새 비밀번호 입력 → 확인 → SHA-256 해싱 후 저장

### 4.2 과목 생성 (교수)

```
교수 대시보드 → "새 과목 만들기"
  → 과목 이름 입력 (예: "소프트웨어공학개론")
  → 년도 입력 (예: 2026)
  → 학기 선택 (1학기 / 2학기 / 여름학기 / 겨울학기)
  → "만들기" 클릭
  → Apps Script가:
    1. 마스터 스프레드시트에 과목_목록 시트가 없으면 자동 생성
    2. Google Spreadsheet 생성: "CrossEval-2026-1-소프트웨어공학개론"
    3. _config, 학생_마스터, 과제_목록 시트 자동 생성
    4. 마스터 스프레드시트의 과목_목록에 레코드 추가 (상태 = "활성")
  → 과목 목록 화면으로 돌아감
```

### 4.2.1 과목 선택 및 현재 과목 표시 (v2.1 추가)

```
교수 → 대시보드 → "과목 관리" 탭 → 활성 과목의 "선택" 버튼 클릭
  → localStorage에 선택된 과목 정보 저장 (courseId, courseName) — 브라우저 탭/재시작 후에도 유지
  → 대시보드 헤더의 로그아웃 버튼 왼쪽에 현재 선택된 과목명 표시
  → 과제 관리, 학생 관리 등 다른 탭은 선택된 과목 기준으로 동작
```

**규칙:**
- 로그아웃 버튼 왼쪽에 현재 선택된 과목명이 항상 표시됨
- 과목 미선택 시 "과목을 선택하세요" 안내 표시
- 삭제된 과목은 선택 불가 (선택 버튼 비활성화, 행 전체 흐리게 표시)
- 과목 선택 상태는 localStorage에 저장 (브라우저 재시작 후에도 유지)

### 4.2.2 과목 삭제 (교수)

```
교수 → "과목 관리" 탭 → 해당 과목의 "삭제" 버튼 클릭
  → 확인 모달: "'{과목명}' 과목을 삭제하시겠습니까? 과목 데이터(스프레드시트)는 보존됩니다."
  → "확인" 클릭
  → Apps Script가:
    1. 과목_목록 시트에서 해당 과목의 상태를 "삭제됨"으로 변경
    2. 과목별 스프레드시트는 삭제하지 않음 (데이터 보존)
  → 과목 목록에서 해당 과목이 비활성 표시됨 (흐리게, 선택 불가)
```

**규칙:**
- 과목 삭제 시 과목별 스프레드시트(학생, 과제, 평가 데이터)는 그대로 보존
- 삭제된 과목은 과목 목록에서 "삭제됨" 상태로 표시, 행이 흐리게(opacity) 표시
- 삭제된 과목은 "선택" 버튼 대신 "복원" 버튼만 표시
- 삭제된 과목의 학생은 해당 과목의 과제를 볼 수 없음

### 4.2.3 과목 복원 (교수)

```
교수 → "과목 관리" 탭 → 삭제된 과목의 "복원" 버튼 클릭
  → 확인 모달: "'{과목명}' 과목을 복원하시겠습니까?"
  → "확인" 클릭
  → Apps Script가:
    1. 과목_목록 시트에서 해당 과목의 상태를 "활성"으로 변경
  → 과목 목록에서 해당 과목이 다시 활성 표시됨 (선택 가능)
```

### 4.3 학생 등록 (교수 - 엑셀 업로드)

```
교수 → 과목 선택 → "학생 관리" 탭
  → 엑셀 파일 선택 (.xlsx, .xls, .csv 지원)
  → 프론트엔드에서 SheetJS로 파일 파싱
  → 미리보기 테이블 표시 (학번, 이름)
  → "등록" 클릭
  → API 호출 → 해당 과목 스프레드시트의 학생_마스터에 저장
  → 이미 등록된 학번은 스킵 (중복 방지)
```

**엑셀 파일 형식:**
- 첫 번째 행: 헤더 (어떤 텍스트든 무관, 무시됨)
- A열: 학번, B열: 이름
- 두 번째 행부터 데이터

### 4.3.1 학생 제거 (교수)

```
교수 → 과목 선택 → "학생 관리" 탭
  → 학생 목록에서 제거할 학생의 "삭제" 버튼 클릭
  → 확인 모달 표시: "{이름}({학번}) 학생을 이 과목에서 제거하시겠습니까?"
  → "확인" 클릭
  → API 호출 → 해당 과목 스프레드시트의 학생_마스터에서 해당 학번 행 삭제
  → 학생 목록 갱신
```

**규칙:**
- 수강신청 취소, 휴학 등의 사유로 학생을 과목에서 제거할 수 있다
- 제거된 학생의 기존 제출/평가 데이터는 유지한다 (과제 시트에서 삭제하지 않음)
- 제거 후 해당 학생은 이 과목의 과제/평가에 더 이상 접근할 수 없다
- 이미 진행 중인 상호평가에서 해당 학생이 평가자로 배정되어 있는 경우, 미완료 평가는 그대로 미완료로 남는다
- 제거된 학생을 다시 등록할 수 있다 (엑셀 업로드 시 새로 추가됨)

### 4.4 학생 최초 등록 / 로그인

```
학생 → GitHub Pages 접속
  → 학번 입력
  → 마스터 스프레드시트의 과목_목록 순회 → 각 과목 시트의 학생_마스터에서 학번 검색
  → [학번이 어떤 과목에도 없으면] → "등록되지 않은 학번입니다" 안내
  → [학번이 존재] → 비밀번호 컬럼 확인
    → [비밀번호 비어있음] → 최초 로그인 → 비밀번호 설정 화면
    → [비밀번호 있음] → 비밀번호 입력 → SHA-256 해싱 후 비교 → 일치 시 로그인
  → 로그인 성공 → 세션 유지 (브라우저 sessionStorage)
```

**규칙:**
- 학번이 `학생_마스터` 시트에 없으면 로그인 불가 (사전 등록 필수)
- 비밀번호 컬럼이 비어있으면 → 최초 로그인 → 비밀번호 설정
- 비밀번호 컬럼에 값이 있으면 → 비밀번호 확인
- 세션은 브라우저 `sessionStorage`에 `{role, studentId, password, name}` 저장 (탭 닫으면 만료)
- **학생은 과목 선택이 필요 없음**: 자신이 등록된 모든 과목의 과제가 한 화면에 표시됨

### 4.5 교수 로그인

```
교수 → GitHub Pages 접속 → 교수 탭 선택
  → 비밀번호 입력
  → 마스터 _config 시트의 admin_password와 비교
  → [admin_password 빈 값] → 'minsuk615'와 비교 → 일치 시 비밀번호 변경 강제
  → [admin_password 있음] → SHA-256 해싱 후 비교 → 일치 시 과목 선택 화면
```

### 4.6 과제 생성 (교수)

```
교수 → 과목 선택 → 과제 만들기 탭
  → 과제명, 설명, 제출마감일시, 채점기준, 점수범위 입력
  → "교수도 평가" 체크박스 (선택): 교수가 직접 평가할 과제인지 여부
  → Apps Script가:
    1. 과제_목록 시트에 행 추가 (상태 = "제출중", 교수평가여부 = Y/N)
    2. "제출_A{n}" 시트 생성
    3. "평가_A{n}" 시트 생성
  → 생성 즉시 학생이 과제 링크 제출 가능
```

> **v2.0 변경**: Google Form 생성 제거. 과제 생성 즉시 상태 = `제출중` (v1.0의 `대기` 상태 제거).
> **v2.2 변경**: 과제 생성 시 "교수도 평가" 체크박스 추가. 체크하면 `교수평가여부 = Y`.

### 4.7 과제 제출 (학생)

> **v2.1 구현 완료**: 학생 대시보드에서 마감 전 과제에 대해 설명, 채점기준, 제출 UI를 모두 표시.

```
학생 → 대시보드 로그인
  → 과제 목록 표시:
    ▸ 마감 전("대기"/"제출중") 과제:
      - 과제명, 설명, 채점기준 전문 표시
      - 제출마감일시 표시
      - ⚠ 제출 폼 위에 블라인드 안내문 표시:
        "상호평가는 블라인드로 진행됩니다. 과제 결과물에 이름, 학번 등 본인을 식별할 수 있는 표식을 포함하지 마세요."
      - 미제출: "제출하기" 버튼 + 구글 문서 URL 입력 필드
      - 제출완료: "제출 완료" 뱃지 + 제출 링크 클릭 가능 + "다시 제출" 버튼
    ▸ "다시 제출" 클릭 시:
      - URL 입력 필드 다시 표시
      - 제출하면 이전 제출 데이터를 '유효=N' 처리, 새 제출을 '유효=Y'로 덮어쓰기
    ▸ 마감 지남 + 상호평가 시작 전:
      - "마감됨" 표시, 제출 불가
    ▸ 상호평가 시작("평가중") 이후:
      - 기존 평가 UI 유지

  → 제출 시 백엔드에서:
    1. URL 형식 기본 검증 (http:// 또는 https:// 로 시작하는지)
    2. ~~UrlFetchApp으로 URL 접근 가능 여부 확인~~ (v2.2 제거: 서버에서 접근 불가한 경우가 많아 검증 제거)
    3. 과제_{n}_제출 시트에 기존 제출이 있으면 유효=N 처리
    4. 새 행 추가: [타임스탬프, '', 학번, 이름, '', 제출파일_링크, 'Y']
    5. 성공 응답 반환
  → 프론트엔드에서 제출 폼 위에 "구글 문서 공유 설정 안내" 문구 표시 (UI만, 서버 검증 없음)
```

### 4.8 상호평가 시작 (교수)

교수가 "상호평가 시작" 버튼을 누르면 Apps Script에서 다음을 순서대로 실행:

> **v2.0 핵심 변경**: 제출마감 전이라도 교수가 "상호평가 시작" 버튼을 클릭할 수 있음. 상호평가가 시작되면 추가 제출은 불가.

#### Step 1: 제출 현황 확인
```
제출_A{n} 시트에서:
  → 제출한 학생 목록 추출
  → 미제출 학생은 평가 배정에서 제외
```

#### Step 2: 평가 배정 알고리즘

**입력:** 제출한 학생 목록 (N명)

**목표:**
- 각 학생은 **2~3명의 다른 학생을 평가**
- 각 학생은 **2~3명에게 평가받음**
- 자기 자신을 평가하지 않는다
- 평가 배정이 가능한 한 균등하다

**알고리즘:**
```
1. 제출 학생 리스트 S = [s1, s2, ..., sN] 을 랜덤 셔플
2. N >= 4인 경우: 3명 배정 (Circular Offset +1, +2, +3)
   - 학생 S[i]의 평가 대상: S[(i+1)%N], S[(i+2)%N], S[(i+3)%N]
3. N == 3인 경우: 2명 배정 (Circular Offset +1, +2)
   - 학생 S[i]의 평가 대상: S[(i+1)%N], S[(i+2)%N]
4. N < 3인 경우: 상호평가 불가 알림

결과:
- N >= 4: 각 학생이 3명을 평가하고 3명에게 평가받음
- N == 3: 각 학생이 2명을 평가하고 2명에게 평가받음
```

#### Step 3: 평가 시트 기록
```
평가_A{n} 시트에:
  → 피평가자 기준 1행 생성
  → 각 피평가자의 평가자 학번을 기록 (2~3명)
  → 점수/서술평 칸은 빈칸
```

#### Step 4: 과제 상태 변경
```
과제_목록 시트에서 해당 과제의 상태를 "평가중"으로 변경
평가마감일시를 교수가 입력한 값으로 설정
```

### 4.9 상호평가 수행 (학생)

```
학생 → GitHub Pages 로그인
  → 대시보드에서 "평가중" 과제 확인
  → "평가하기" 버튼 클릭 → 평가 화면 (evaluate.html) 이동
  → 평가 화면:
    - 배정된 피평가자는 "학생 1", "학생 2" (익명 라벨)로만 표시
    - ⚠ 피평가자의 이름/학번은 절대 노출하지 않음 (블라인드 평가)
    - 각 학생에 대해:
      · 과제물 보기 링크 (새 탭에서 열림)
      · 채점 기준 표시
      · 점수 입력 (min~max 범위 내 정수)
      · 서술평 입력 (textarea, 최소 20자)
      · "제출하기" → 평가배정 시트에 기록
    - 미완료 대상: "미완료" 뱃지 + 제출 폼
    - 완료된 대상: "평가 완료" 뱃지 + [평가 수정] 버튼
      · [평가 수정] 클릭 → 기존 점수/서술평이 채워진 폼 표시
      · 수정 후 "수정하기" 제출 → 평가배정 시트 덮어쓰기
  → 모든 평가 완료 시 축하 메시지 + "마감 전까지 수정 가능" 안내
```

**제약:**
- 평가 마감일시 이후에는 제출 불가
- 한 번 제출한 평가는 마감 전까지 수정 가능 (완료 후에도 [평가 수정] 버튼 제공)
- 점수는 정수만 허용, 범위 검증
- **⚠ 블라인드 평가 필수**: 피평가자의 실제 이름/학번은 비공개 (학생 1, 학생 2 등으로만 표시)
  - 백엔드 API(`get_evaluation_targets`)에서 `targetName`에 실제 이름 대신 "학생 1", "학생 2" 반환
  - 프론트엔드에서 학번(`targetStudentId`)을 화면에 표시하지 않음

### 4.10 평가 종료 및 결과 집계 (교수)

```
교수 → "평가 종료" 버튼
  → Apps Script가:
    1. 평가_A{n} 시트에서 미제출 평가자 목록 추출
    2. 교수에게 미완료자 목록 표시
    3. 과제 상태를 "평가완료"로 변경
```

### 4.10.1 제출 현황 조회 (교수) (v2.2 신규)

```
교수 → 과제 관리 → 과제 카드에서 [제출 현황] 버튼 클릭
  → 백엔드에서 get_submission_status 호출:
    1. 학생_마스터에서 전체 학생 수(N) 조회
    2. 제출_A{n} 시트에서 유효(Y) 제출자 목록 추출
    3. 미제출 학생 학번 목록 계산
  → 표시 내용:
    - "M / N 명 제출" (예: "12 / 15 명 제출")
    - 미제출 학생 학번 (콤마 구분): "20210003, 20210007, 20210012"
    - 제출 학생 목록: 한 줄에 2명씩 표시
      - 각 학생: "학번 이름 [제출 과제] [평가]"
      - [제출 과제] 클릭 → 새 브라우저 탭에서 제출 링크 열기
      - [평가] 클릭 → 채점기준 표시 + 점수/서술평 입력 폼
  → 교수 평가 입력:
    - 이미 평가한 학생: 기존 점수/서술평이 폼에 표시됨 (재평가 가능)
    - 저장 → _결과 시트 또는 _제출 시트의 교수 평가 컬럼에 기록
```

**규칙:**
- 제출 현황은 '제출중' 상태일 때도 볼 수 있음 (상호평가 시작 전에도)
- [평가] 버튼은 `교수평가여부 = Y` 인 과제에서만 표시
- 교수는 한 번 평가한 뒤에도 다시 평가(수정) 가능
- 제출 학생 목록은 학번 순으로 정렬

### 4.11 교수 평가 입력

```
교수 → 과제 관리 → [제출 현황] → 제출 학생의 [평가] 버튼 클릭
  → 해당 과제의 채점기준 표시
  → 점수 입력 (min~max 범위)
  → 서술평 입력 (textarea)
  → "저장" 클릭 → 결과 시트에 기록
  → 이미 평가한 경우 기존 값이 표시되며, 수정 후 저장 시 덮어쓰기
  → 모든 학생 교수평가 완료 후 "확정" 버튼 → 상태를 "확정"으로 변경
```

> **v2.2 변경**: 교수 평가를 별도 화면이 아닌 제출 현황 내에서 인라인으로 수행. 재평가 가능.

### 4.12 학생 결과 확인

```
학생 → GitHub Pages 로그인
  → 대시보드에서 "확정" 과제의 "결과 보기" 클릭
  → 표시 내용:
    - 동료 평가: 평가자1 점수 + 서술평, 평가자2 점수 + 서술평, [평가자3 점수 + 서술평]
    - 동료 평균 점수
    - 교수 평가: 점수 + 서술평
  → 평가자의 학번/이름은 비공개 (평가자1, 평가자2, 평가자3으로만 표시)
  → 평가자가 2명인 경우 평가자3 영역은 표시하지 않음
```

---

## 5. API 설계 (Google Apps Script 엔드포인트)

모든 API는 단일 Web App URL에 `action` 파라미터로 구분한다.

### 5.1 인증 관련

| Action | Method | 파라미터 | 반환 | 설명 |
|--------|--------|---------|------|------|
| `check_student` | POST | studentId | 존재여부 + 비밀번호 설정 여부 + 이름 | 학번 확인 (전체 과목 검색) |
| `register_password` | POST | studentId, password | 성공/실패 | 최초 비밀번호 설정 |
| `login` | POST | studentId, password | 성공/실패 + 학생 정보 | 로그인 |
| `admin_login` | POST | password | 성공/실패 + needPasswordChange | 교수 로그인 (**빈 비밀번호면 초기값 허용**) |
| `change_admin_password` | POST | adminPassword, newPassword | 성공/실패 | **교수 비밀번호 변경 (v2.0 신규)** |

### 5.2 과목 관리 (v2.0 신규)

| Action | Method | 파라미터 | 반환 | 설명 |
|--------|--------|---------|------|------|
| `create_course` | POST | adminPassword, courseName, year, semester | 과목ID + 스프레드시트ID | **과목 생성 (스프레드시트 자동 생성)** |
| `get_courses_list` | POST | adminPassword | 과목 목록 | **과목 목록 조회** |
| `delete_course` | POST | adminPassword, courseId | 성공/실패 | **과목 삭제 (상태를 "삭제됨"으로 변경, 데이터 보존)** |
| `restore_course` | POST | adminPassword, courseId | 성공/실패 | **과목 복원 (상태를 "활성"으로 변경)** |

### 5.3 학생 관리

| Action | Method | 파라미터 | 반환 | 설명 |
|--------|--------|---------|------|------|
| `register_students` | POST | adminPassword, courseId, students (배열) | 성공/실패 + 등록 수 | 학생 일괄 등록 (**학번+이름만**) |
| `get_students_list` | POST | adminPassword, courseId | 학생 목록 | 과목의 학생 목록 조회 |
| `reset_password` | POST | adminPassword, courseId, studentId | 성공/실패 | 학생 비밀번호 초기화 |
| `remove_student` | POST | adminPassword, courseId, studentId | 성공/실패 | **학생 제거 (학생_마스터에서 삭제)** |

### 5.4 과제 관리 (교수용)

| Action | Method | 파라미터 | 반환 | 설명 |
|--------|--------|---------|------|------|
| `create_assignment` | POST | adminPassword, courseId, name, desc, deadline, criteria, minScore, maxScore, **professorEval** | 과제ID | 과제 생성 (**상태 즉시 `제출중`**, 교수평가여부 설정) |
| `get_submission_status` | POST | adminPassword, courseId, assignmentId | 전체/제출 학생 수, 미제출자 학번, 제출자 상세 | **제출 현황 조회 (v2.2 신규)** |
| `get_assignments_list` | POST | adminPassword, courseId | 과제 목록 + 제출 현황 | 과제 목록 조회 |
| `start_evaluation` | POST | adminPassword, courseId, assignmentId, evalDeadline | 배정 결과 요약 | **상호평가 시작 (마감 전 가능)** |
| `end_evaluation` | POST | adminPassword, courseId, assignmentId | 미제출자 목록 | 평가 종료 |
| `get_eval_status` | POST | adminPassword, courseId, assignmentId | 학생별 평가 완료 현황 | 평가 진행 현황 |
| `submit_professor_eval` | POST | adminPassword, courseId, assignmentId, studentId, score, comment | 성공/실패 | 교수 평가 입력 |
| `finalize_assignment` | POST | adminPassword, courseId, assignmentId | 성공/실패 | 과제 확정 |
| `get_all_results` | POST | adminPassword, courseId, assignmentId | 전체 학생 결과 | 전체 결과 조회 |

### 5.5 학생용 API

| Action | Method | 파라미터 | 반환 | 설명 |
|--------|--------|---------|------|------|
| `get_my_assignments` | POST | studentId, password | 전체 과목의 과제 목록 | 내 과제 목록 (과목별) |
| `submit_assignment` | POST | studentId, password, courseId, assignmentId, link | 성공/실패 | **과제 링크 제출 (v2.0 신규)** |
| `get_submission` | POST | studentId, password, courseId, assignmentId | 제출 정보 | **내 제출 정보 조회 (v2.0 신규)** |
| `get_evaluation_targets` | POST | studentId, password, courseId, assignmentId | 평가 대상 목록 (**익명: 학생1, 학생2**) | 평가 대상 상세 |
| `submit_evaluation` | POST | studentId, password, courseId, assignmentId, targetIndex, score, comment | 성공/실패 | 평가 제출 (**targetIndex로 익명 참조**) |
| `get_my_results` | POST | studentId, password, courseId, assignmentId | 받은 점수 + 서술평 + 교수 평가 | 내 결과 조회 |

> **v2.0 변경**: 모든 학생 API에 `courseId` 추가. `submit_assignment`, `get_submission` 신규. `get_evaluation_targets` 응답에서 피평가자 이름/학번 대신 `학생1`, `학생2` 등 익명 라벨 반환. `submit_evaluation`에서 `targetStudentId` 대신 `targetIndex` 사용 (익명성 보강).

---

## 6. 프론트엔드 화면 구성

### 6.1 공통
- **로그인 페이지** (`index.html`): 학생/교수 탭 전환
  - 학생: 학번 → 비밀번호 (2단계)
  - 교수: 비밀번호만 입력 (빈 필드 시 초기 비밀번호 허용)
- **비밀번호 변경 페이지**: 교수 초기 로그인 시 강제 이동

### 6.2 교수 화면
| 화면 | 파일 | 설명 |
|------|------|------|
| 과목 대시보드 | `admin/dashboard.html` | **과목 관리 탭** (과목 추가/선택/삭제/복원), 과제 목록, 상태별 관리, **상호평가 시작 버튼 (마감 전 가능)**, **제출 현황 + 교수 직접평가**, **헤더에 현재 선택 과목명 표시** |
| 과제 만들기 | (대시보드 내 탭) | 과제 정보 입력 |
| 학생 관리 | (대시보드 내 탭) | **엑셀 업로드**, 학생 목록, 비밀번호 초기화, **학생 제거** |
| 평가 관리 | (대시보드 내) | 평가 현황 모니터링 |
| 교수 평가 | (대시보드 내) | 학생별 제출물 + 상호평가 요약 + 교수 점수 입력 |
| 전체 결과 | (대시보드 내) | 전체 결과 테이블, CSV 내보내기 |
| 설정 | (모달) | **비밀번호 변경 (v2.0 신규)** |

### 6.3 학생 화면
| 화면 | 파일 | 설명 |
|------|------|------|
| 대시보드 | `student/dashboard.html` | **전체 과목**의 과제 목록 (과목명 태그 표시), 상태별 액션 |
| 과제 제출 | (대시보드 내 또는 모달) | **링크 입력 + 공유 안내 메시지 (v2.0 신규)** |
| 상호평가 | `student/evaluate.html` | **익명(학생1, 학생2) 표시**, 제출 링크 + 채점기준 + 점수/서술평 입력 |
| 내 결과 | `student/results.html` | **평가자별 점수+서술평(최대3명)** + 교수 평가, 평가자2명이면 3번째 미표시 |

---

## 7. 평가 배정 알고리즘 상세

### 7.1 기본 알고리즘 (Circular Offset)

```javascript
function assignEvaluators(students) {
  // students: 유효 제출한 학생 학번 배열
  const N = students.length;
  if (N < 3) throw new Error("최소 3명 이상 제출해야 상호평가 가능");

  // Fisher-Yates 셔플
  const shuffled = [...students];
  for (let i = N - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }

  // 원형 배정
  const assignments = [];
  const offsetCount = (N >= 4) ? 3 : 2; // v2.0: N>=4면 3명, N==3이면 2명

  for (let i = 0; i < N; i++) {
    const targets = [];
    for (let k = 1; k <= offsetCount; k++) {
      targets.push(shuffled[(i + k) % N]);
    }
    assignments.push({
      evaluator: shuffled[i],
      targets: targets
    });
  }

  return assignments;
}
```

### 7.2 결과 분석

- **N >= 4인 경우:**
  - 각 학생은 정확히 **3명을 평가**
  - 각 학생은 정확히 **3명에게 평가받음**
  - 총 평가 건수: **3N건**
- **N == 3인 경우:**
  - 각 학생은 정확히 **2명을 평가**
  - 각 학생은 정확히 **2명에게 평가받음**
  - 총 평가 건수: **6건**
- **자기 자신 배정**: N ≥ 3일 때 불가능 (`i ≠ (i+k)%N` for k=1,2,3)

### 7.3 평가자 수 유동성
- 평가_A{n} 시트에서 평가자3 컬럼이 비어있으면 해당 학생은 2명에게만 평가받은 것
- 결과 표시 시 비어있는 평가자3 영역은 표시하지 않음

---

## 8. 보안 고려사항

### 8.1 인증
| 항목 | 방식 | 비고 |
|------|------|------|
| 학생 비밀번호 | SHA-256 해싱 저장 | Apps Script `Utilities.computeDigest()` 사용 |
| 교수 비밀번호 | SHA-256 해싱 저장 (마스터 _config) | **빈 값이면 초기 비밀번호 'minsuk615' 허용** |
| 세션 관리 | sessionStorage | 탭 닫으면 만료 |
| 로그인 실패 제한 | 5회 실패 시 10분 잠금 | PropertiesService로 실패 횟수 추적 |

### 8.2 익명성 보장 (v2.0 강화)
- **상호평가 중**: 피평가자의 실제 이름/학번 대신 `학생1`, `학생2` 등으로 표시
- **결과 확인 시**: 평가자의 학번/이름은 학생에게 노출하지 않음 (`평가자1`, `평가자2`, `평가자3`)
- API 응답에서 평가자/피평가자 학번 필드를 **제거**하여 프론트엔드에 전달

### 8.3 데이터 접근 제어
- Google Spreadsheet: 교수 계정만 직접 접근 가능 (편집 권한)
- Apps Script: 교수 계정으로 배포, "누구나 실행 가능"으로 설정
- 학생은 오직 API를 통해서만 데이터 접근 (시트 직접 접근 불가)
- **모든 교수용 API에 adminPassword 검증**
- **모든 학생용 API에 studentId + password 검증**

---

## 9. 학기 중 운영 시나리오

```
[학기 시작]
  교수 → 시스템 접속 → 초기 비밀번호(minsuk615)로 로그인 → 비밀번호 변경
  교수 → "새 과목 만들기" → 과목명, 년도, 학기 입력 → 스프레드시트 자동 생성
  교수 → 엑셀 파일로 수강생 명단 일괄 등록

[과제 1 출제]
  교수 → 과목 선택 → "과제 만들기" → 과제 정보 입력
  교수 → 수업 시간에 과제 안내 + 제출 방법 안내 (공유 링크 제출)

[과제 1 제출 기간]
  학생 → 시스템 로그인 (최초: 비밀번호 설정) → 과제 링크 제출

[과제 1 상호평가 시작] (제출마감 전이라도 가능)
  교수 → "상호평가 시작" → 평가 마감일시 설정
  시스템 → 제출한 학생 대상 평가자 배정 자동 실행

[과제 1 평가 기간]
  학생 → 시스템 로그인 → 배정된 학생1, 학생2 (익명) 평가 수행
  교수 → 평가 진행 현황 모니터링

[과제 1 평가 마감]
  교수 → "평가 종료" → 미제출자 확인
  교수 → 교수 평가 입력
  교수 → "확정" → 학생에게 결과 공개

[과제 2 출제] → 동일 과정 반복
  ...

[다른 과목] → 과목 선택 후 동일 과정 반복
  ...

[학기 종료]
  교수 → 각 과목 스프레드시트의 학생_마스터 시트에서 과제별 최종점수 열로 성적 산출
```

---

## 10. 에러 처리 및 예외 상황

| 상황 | 처리 방식 |
|------|----------|
| 학생이 과제 미제출 후 평가 시도 | 과제 미제출자는 평가 배정에서 제외, 평가 화면 접근 시 안내 메시지 |
| 평가 마감 후 제출 시도 | API에서 마감일시 검증 후 거부 |
| 제출 학생이 3명 미만 | 상호평가 불가 알림, 교수만 평가 |
| 제출 학생이 정확히 3명 | 2명씩 배정 (3명 배정 불가) |
| 동시 접근으로 인한 충돌 | Apps Script의 `LockService`로 동시 쓰기 방지 |
| 평가자가 평가 미수행 | 교수에게 미완료자 목록 표시 |
| 학생 비밀번호 분실 | 교수가 관리자 화면에서 비밀번호 초기화(삭제) → 학생이 재설정 |
| 교수 초기 비밀번호로 로그인 | 즉시 비밀번호 변경 화면으로 이동 |
| 상호평가 시작 후 추가 제출 시도 | 거부 (상태가 `평가중`이면 제출 불가) |
| 엑셀 파일 형식 오류 | 프론트엔드에서 파싱 실패 시 오류 메시지 표시 |
| 제거된 학생이 과제 접근 시도 | 학생_마스터에 학번 없으므로 해당 과목 과제 비표시 |
| `_config` 시트가 없는 상태에서 API 호출 | `_config` 시트를 자동 생성 후 정상 처리 |
| `과목_목록` 시트가 없는 상태에서 과목 생성/조회 | `과목_목록` 시트를 자동 생성 후 정상 처리 |
| 삭제된 과목의 과제 접근 시도 | 과목 상태가 "삭제됨"이면 해당 과목 과제 비표시 |
| Apps Script 실행 시간 초과 | 대량 처리 시 배치 분할 (100명 단위) |

---

## 11. 향후 확장 가능성

- [ ] 알림 기능 (평가 배정 시, 마감 임박 시)
- [ ] 평가 기준 루브릭(rubric) 지원 (항목별 점수)
- [ ] 평가자 간 점수 편차 분석 리포트
- [ ] Google OAuth 기반 로그인으로 전환 (비밀번호 제거)
- [ ] CSV 내보내기 기능
- [x] ~~과목 삭제/보관 기능~~ (구현됨: 소프트 삭제 + 복원)

---

## 12. 기술적 제약 및 한계

| 항목 | 제약 | 영향 |
|------|------|------|
| Apps Script 일일 실행 | 20,000회 (일반) / 100,000회 (Workspace) | 학생 수 × 일일 접속 빈도 고려 필요 |
| 단일 실행 시간 | 6분 | 대규모 데이터 처리 시 분할 필요 |
| Spreadsheet 셀 수 | 최대 500만 셀 | 과목별 시트이므로 여유로움 |
| CORS | text/plain 전송으로 회피 | JSON 문자열을 text/plain으로 래핑 |
| 동시 접속 | LockService로 제어 | 동시 쓰기 시 대기 발생 가능 |
| 스프레드시트 생성 | Apps Script 일일 생성 한도 존재 | 학기 초 과목 생성 시 주의 |
| SheetJS 라이브러리 크기 | ~300KB (minified) | CDN 또는 로컬 포함 필요 |

---

## 13. 파일 구조

```
cross-eval/
├── apps-script/
│   ├── Code.gs          # 메인 백엔드 로직
│   └── TestRunner.gs    # 테스트 코드
├── frontend/
│   ├── index.html       # 로그인 페이지
│   ├── css/
│   │   └── style.css    # 공통 스타일
│   ├── js/
│   │   ├── api.js       # Apps Script API 호출 모듈
│   │   ├── auth.js      # 인증/세션 관리
│   │   └── xlsx.mini.js # SheetJS 엑셀 파싱 라이브러리 (v2.0 신규)
│   ├── admin/
│   │   ├── courses.html # 과목 선택/생성 (v2.0 신규)
│   │   └── dashboard.html # 과목별 대시보드
│   └── student/
│       ├── dashboard.html # 학생 메인 (과제 목록 + 제출 + 평가)
│       ├── evaluate.html  # 상호평가 수행
│       └── results.html   # 결과 확인
├── PRD.md               # 이 문서
└── README.md
```

---

## 14. 구현 우선순위

### Phase 1: 기본 인프라 + 다중 과목
1. 마스터 스프레드시트 구조 설정
2. 교수 비밀번호 체계 (초기값 + 변경)
3. 과목 생성 API + 과목 선택 UI
4. 학생 일괄 등록 (엑셀 업로드)
5. 로그인 화면 (교수 초기 비밀번호 처리 포함)

### Phase 2: 과제 및 제출
6. 과제 생성 (상태 즉시 `제출중`)
7. 학생 과제 링크 제출 UI + API
8. 교수 과제 목록 + 제출 현황 확인

### Phase 3: 상호평가
9. 상호평가 배정 알고리즘 (2~3명)
10. 학생 상호평가 UI (익명 학생1, 학생2)
11. 평가 제출/수정

### Phase 4: 결과 및 관리
12. 평가 종료 + 교수 평가 입력
13. 과제 확정 + 학생 결과 확인 (평가자별 점수+서술평)
14. 전체 결과 조회

---

## 15. 테스트 데이터 (개발/검증용)

개발 및 검증 과정에서 실제 학생 정보를 사용하지 않는다. 아래 가상 데이터를 사용한다.

### 15.1 시스템 설정

#### 마스터 스프레드시트 `_config`

| 설정 키 | 설정 값 |
|---------|---------|
| admin_password | (빈 값 → 초기 상태, 테스트 시 `minsuk615`로 로그인 후 변경) |
| system_name | 상호평가 시스템 |

### 15.2 가상 과목 데이터

| 과목ID | 과목명 | 년도 | 학기 | 스프레드시트명 |
|--------|--------|------|------|---------------|
| C1 | 소프트웨어공학개론 | 2026 | 1 | CrossEval-2026-1-소프트웨어공학개론 |
| C2 | 데이터베이스설계 | 2026 | 1 | CrossEval-2026-1-데이터베이스설계 |

### 15.3 가상 학생 명단 — 과목1: 소프트웨어공학개론 (8명)

| 학번 | 이름 | 비밀번호 (원문) |
|------|------|----------------|
| 20210001 | 김민수 | (최초 로그인 시 설정) |
| 20210002 | 이서연 | (최초 로그인 시 설정) |
| 20210003 | 박준혁 | (최초 로그인 시 설정) |
| 20210004 | 최유진 | (최초 로그인 시 설정) |
| 20210005 | 정하은 | (최초 로그인 시 설정) |
| 20210006 | 강도윤 | (최초 로그인 시 설정) |
| 20210007 | 윤서준 | (최초 로그인 시 설정) |
| 20210008 | 한지민 | (최초 로그인 시 설정) |

> 테스트 시 비밀번호는 모두 `test1234!`로 통일하여 설정한다.

### 15.4 가상 학생 명단 — 과목2: 데이터베이스설계 (5명, 일부 과목1과 중복)

| 학번 | 이름 |
|------|------|
| 20210001 | 김민수 |
| 20210003 | 박준혁 |
| 20210005 | 정하은 |
| 20210009 | 임채원 |
| 20210010 | 송태양 |

> 20210001, 20210003, 20210005는 두 과목 모두 등록. 학생 대시보드에서 두 과목의 과제가 모두 표시되는지 검증.

### 15.5 가상 과제 데이터

#### 과제 1 (과목1): "UML 클래스 다이어그램 작성"

**과제_목록 행:**

| 과제ID | 과제명 | 과제설명 | 제출마감일시 | 평가마감일시 | 상태 | 채점기준_설명 | 최소점수 | 최대점수 |
|--------|--------|---------|-------------|-------------|------|-------------|---------|---------|
| 과제1 | UML 클래스 다이어그램 작성 | 주어진 요구사항을 분석하여 클래스 다이어그램을 작성하시오 | 2026-04-10 23:59 | 2026-04-14 23:59 | 제출중 | 1)클래스 식별 적절성(30점) 2)관계 표현 정확성(40점) 3)다이어그램 가독성(30점) | 0 | 100 |

**과제1 제출 데이터** (학생이 직접 링크 제출):

| 학번 | 제출링크 | 제출시각 |
|------|---------|---------|
| 20210001 | https://docs.google.com/document/d/fake_001 | 2026-04-09 14:30 |
| 20210002 | https://docs.google.com/document/d/fake_002 | 2026-04-09 15:10 |
| 20210003 | https://drive.google.com/file/d/fake_003 | 2026-04-09 18:22 |
| 20210004 | https://docs.google.com/document/d/fake_004 | 2026-04-10 09:05 |
| 20210005 | https://drive.google.com/file/d/fake_005 | 2026-04-10 11:30 |
| 20210006 | https://docs.google.com/document/d/fake_006 | 2026-04-10 20:15 |
| 20210007 | https://drive.google.com/file/d/fake_007 | 2026-04-10 22:45 |

> **검증 포인트:** 한지민(20210008)은 미제출. 평가 배정에서 제외되어야 함.
> **결과:** 유효 제출자 7명 (20210001~20210007). 7명이므로 3명씩 배정.

**과제1 평가 배정 예시** (셔플 결과에 따라 달라짐, 아래는 검증용 고정 예시):

셔플 후 순서: [20210003, 20210006, 20210001, 20210005, 20210007, 20210002, 20210004]

| 평가자 | 평가대상1 | 평가대상2 | 평가대상3 |
|--------|----------|----------|----------|
| 20210003 박준혁 | 20210006 강도윤 | 20210001 김민수 | 20210005 정하은 |
| 20210006 강도윤 | 20210001 김민수 | 20210005 정하은 | 20210007 윤서준 |
| 20210001 김민수 | 20210005 정하은 | 20210007 윤서준 | 20210002 이서연 |
| 20210005 정하은 | 20210007 윤서준 | 20210002 이서연 | 20210004 최유진 |
| 20210007 윤서준 | 20210002 이서연 | 20210004 최유진 | 20210003 박준혁 |
| 20210002 이서연 | 20210004 최유진 | 20210003 박준혁 | 20210006 강도윤 |
| 20210004 최유진 | 20210003 박준혁 | 20210006 강도윤 | 20210001 김민수 |

> **검증 포인트:** 각 학생이 정확히 3회 평가하고, 정확히 3회 평가받는지, 자기 자신이 포함되지 않았는지 확인.
> **학생 화면 표시 검증:** 20210003에게는 피평가자가 "학생1", "학생2", "학생3"으로만 보임 (실제 이름 비공개).

**과제1 상호평가 입력 테스트 데이터:**

| 평가자 | 피평가자 | 점수 | 서술평 |
|--------|---------|------|--------|
| 20210003 | 20210006 | 78 | 클래스 식별은 적절하나 상속 관계 표현에 개선이 필요합니다. 다이어그램 전체적으로 깔끔합니다. |
| 20210003 | 20210001 | 85 | 요구사항 분석이 정확하고 클래스 간 관계가 잘 표현되어 있습니다. 일부 속성 명명이 모호합니다. |
| 20210003 | 20210005 | 73 | 핵심 클래스는 잘 도출했으나 인터페이스 활용이 부족합니다. 기본 구조는 좋습니다. |
| 20210006 | 20210001 | 82 | 전반적으로 완성도가 높습니다. 다중성 표기가 일부 누락되어 있어 아쉽습니다. |
| 20210006 | 20210005 | 70 | 기본 클래스 구조는 파악했으나 연관 관계와 의존 관계 구분이 부정확합니다. |
| 20210006 | 20210007 | 88 | 매우 체계적이고 가독성이 뛰어납니다. 확장성을 잘 고려했습니다. |
| 20210001 | 20210005 | 71 | 핵심 클래스는 잘 도출했으나 인터페이스 활용이 부족하고 패키지 구분이 없습니다. |
| 20210001 | 20210007 | 90 | 매우 체계적이고 가독성이 뛰어납니다. UML 표기법을 정확하게 따르고 있습니다. |
| 20210001 | 20210002 | 80 | 전체 구조 파악이 잘 되어있고, 메서드 시그니처까지 상세히 작성한 점이 좋습니다. |
| 20210005 | 20210007 | 87 | 다이어그램이 명확하고 클래스 간 관계 표현이 우수합니다. 약간의 중복 클래스가 있습니다. |
| 20210005 | 20210002 | 79 | 전체 구조가 적절하고, 메서드 정의가 상세합니다. 일부 관계 방향이 불분명합니다. |
| 20210005 | 20210004 | 66 | 기본 구조는 이해했으나 추상 클래스와 인터페이스 구분이 안 되어 있습니다. |
| 20210007 | 20210002 | 77 | 클래스 수가 적절하며 구조가 간결합니다. 다만 일부 관계의 방향성이 불명확합니다. |
| 20210007 | 20210004 | 65 | 기본 구조는 이해했으나 추상 클래스와 인터페이스 구분이 안 되어 있고 표기법 오류가 있습니다. |
| 20210007 | 20210003 | 82 | 다이어그램이 잘 구조화되어 있고 패키지 분리가 적절합니다. |
| 20210002 | 20210004 | 68 | 클래스 식별이 다소 부족하고, 연관 관계 표현에 오류가 있습니다. 전체 레이아웃은 깔끔합니다. |
| 20210002 | 20210003 | 83 | 다이어그램이 잘 구조화되어 있고 패키지 분리가 적절합니다. 일부 메서드 누락이 보입니다. |
| 20210002 | 20210006 | 76 | 기본기는 갖추었으나 복합 관계 표현이 미흡합니다. 노트 활용이 좋았습니다. |
| 20210004 | 20210003 | 81 | 전반적으로 우수합니다. 디자인 패턴 적용 흔적이 보이며 확장성을 고려한 설계입니다. |
| 20210004 | 20210006 | 75 | 기본기는 갖추었으나 복합 관계 표현이 미흡합니다. 노트 활용이 좋았습니다. |
| 20210004 | 20210001 | 84 | 요구사항 분석이 정확하고 설계가 깔끔합니다. 일부 세부 사항 보완이 필요합니다. |

**과제1 교수 평가 테스트 데이터:**

| 학번 | 교수_점수 | 교수_서술평 |
|------|----------|-----------|
| 20210001 | 84 | 요구사항을 정확히 분석하여 핵심 클래스를 잘 도출했습니다. 관계 표현도 대체로 정확합니다. |
| 20210002 | 79 | 기본 구조는 좋으나 일부 클래스의 책임 분리가 더 필요합니다. |
| 20210003 | 82 | 디자인 패턴을 적절히 활용한 점이 좋습니다. 다이어그램 가독성도 우수합니다. |
| 20210004 | 63 | 클래스 식별과 관계 표현 모두 보완이 필요합니다. 수업 내용을 다시 복습하기 바랍니다. |
| 20210005 | 72 | 핵심 구조는 파악했으나 세부 설계에서 아쉬운 점이 많습니다. |
| 20210006 | 76 | 전체적으로 무난하나 고급 관계 표현(합성, 집합)에 대한 이해가 부족합니다. |
| 20210007 | 91 | 매우 우수합니다. 요구사항 분석부터 설계까지 체계적이고 완성도가 높습니다. |

**과제1 기대 결과 집계 (`평가_A1` 최종 상태):**

| 피평가자 | 평가자1→점수 | 평가자2→점수 | 평가자3→점수 | 교수점수 | 동료평균 |
|---------|-------------|-------------|-------------|---------|---------|
| 20210001 김민수 | 85 (←20210003) | 82 (←20210006) | 84 (←20210004) | 84 | 83.7 |
| 20210002 이서연 | 80 (←20210001) | 79 (←20210005) | 77 (←20210007) | 79 | 78.7 |
| 20210003 박준혁 | 82 (←20210007) | 83 (←20210002) | 81 (←20210004) | 82 | 82.0 |
| 20210004 최유진 | 66 (←20210005) | 65 (←20210007) | 68 (←20210002) | 63 | 66.3 |
| 20210005 정하은 | 73 (←20210003) | 70 (←20210006) | 71 (←20210001) | 72 | 71.3 |
| 20210006 강도윤 | 78 (←20210003) | 76 (←20210002) | 75 (←20210004) | 76 | 76.3 |
| 20210007 윤서준 | 88 (←20210006) | 90 (←20210001) | 87 (←20210005) | 91 | 88.3 |

> 위 (←학번) 표기는 검증 참조용이며 학생에게는 노출되지 않는다.

#### 과제 2 (과목1): "시퀀스 다이어그램 작성" (2회차 과제 테스트용)

| 과제ID | 과제명 | 제출마감일시 | 평가마감일시 | 최소점수 | 최대점수 |
|--------|--------|-------------|-------------|---------|---------|
| 과제2 | 시퀀스 다이어그램 작성 | 2026-04-24 23:59 | 2026-04-28 23:59 | 0 | 100 |

**과제2 제출 데이터** (5명만 제출 — 20210004, 20210006, 20210008 미제출):

| 학번 | 제출링크 | 제출시각 |
|------|---------|---------|
| 20210001 | https://docs.google.com/document/d/fake2_001 | 2026-04-23 10:00 |
| 20210002 | https://docs.google.com/document/d/fake2_002 | 2026-04-23 14:20 |
| 20210003 | https://drive.google.com/file/d/fake2_003 | 2026-04-23 16:00 |
| 20210005 | https://drive.google.com/file/d/fake2_005 | 2026-04-24 09:30 |
| 20210007 | https://drive.google.com/file/d/fake2_007 | 2026-04-24 22:50 |

> **검증 포인트:** 과제2에서는 5명 제출. 5 >= 4이므로 3명씩 배정. 20210004, 20210006, 20210008은 미제출이므로 평가 배정에서 제외.

#### 과제 3 (과목1): "3명만 제출한 극단 케이스"

| 과제ID | 과제명 | 제출마감일시 | 최소점수 | 최대점수 |
|--------|--------|-------------|---------|---------|
| 과제3 | 유스케이스 다이어그램 | 2026-05-08 23:59 | 0 | 100 |

**과제3 제출 데이터** (3명만 제출):

| 학번 | 제출링크 | 제출시각 |
|------|---------|---------|
| 20210001 | https://docs.google.com/document/d/fake3_001 | 2026-05-07 10:00 |
| 20210002 | https://docs.google.com/document/d/fake3_002 | 2026-05-07 14:20 |
| 20210003 | https://drive.google.com/file/d/fake3_003 | 2026-05-08 16:00 |

> **검증 포인트:** 3명이므로 2명씩 배정. 평가_A3 시트에서 평가자3 컬럼은 모든 행에서 빈 값. 결과 화면에서 평가자3 영역이 표시되지 않아야 함.

#### 과제 4 (과목2): "ER 다이어그램 작성" (다중 과목 테스트)

| 과제ID | 과제명 | 제출마감일시 | 최소점수 | 최대점수 |
|--------|--------|-------------|---------|---------|
| 과제1 | ER 다이어그램 작성 | 2026-04-15 23:59 | 0 | 100 |

**과제4 제출 데이터** (과목2의 5명 모두 제출):

| 학번 | 제출링크 | 제출시각 |
|------|---------|---------|
| 20210001 | https://docs.google.com/document/d/fake_db_001 | 2026-04-14 10:00 |
| 20210003 | https://drive.google.com/file/d/fake_db_003 | 2026-04-14 14:20 |
| 20210005 | https://drive.google.com/file/d/fake_db_005 | 2026-04-14 16:00 |
| 20210009 | https://docs.google.com/document/d/fake_db_009 | 2026-04-15 09:30 |
| 20210010 | https://docs.google.com/document/d/fake_db_010 | 2026-04-15 18:00 |

> **검증 포인트:** 과목2의 과제. 20210001, 20210003, 20210005는 과목1과 과목2 모두에 등록. 학생 대시보드에서 두 과목의 과제가 모두 표시되는지 확인.

### 15.6 테스트 데이터 관리 규칙

1. **초기화 스크립트**: Apps Script에 `initTestData()` 함수를 구현하여, 위 테스트 데이터를 시트에 일괄 입력하는 기능 제공
2. **리셋 스크립트**: `resetAllData()` 함수로 모든 시트를 초기 상태(빈 헤더만)로 되돌리는 기능 제공
3. **테스트 모드 플래그**: `_config` 시트에 `test_mode=true` 설정 시, 마감일시 검증을 건너뛰어 언제든 테스트 가능
4. **고정 셔플**: 테스트 모드에서는 평가 배정 시 셔플을 고정 시드로 실행하여 결과 재현 가능 (검증 목적)

---

## 16. 테스트 계획

### 16.1 자동 테스트 (Apps Script 내 테스트 함수)

Apps Script에 `TestRunner` 모듈을 구현하여, 아래 테스트를 `runAllTests()` 함수 한 번 호출로 일괄 실행한다. 결과는 `_test_log` 시트에 기록한다.

#### 16.1.1 인증 테스트

| 테스트 ID | 테스트명 | 절차 | 기대 결과 |
|-----------|---------|------|----------|
| AUTH-01 | 학번 존재 확인 | `check_student("20210001")` 호출 | `{exists: true, hasPassword: false}` |
| AUTH-02 | 미등록 학번 확인 | `check_student("99999999")` 호출 | `{exists: false}` |
| AUTH-03 | 최초 비밀번호 설정 | `register_password("20210001", "test1234!")` 호출 | 성공, 시트에 SHA-256 해시 저장 확인 |
| AUTH-04 | 정상 로그인 | `login("20210001", "test1234!")` 호출 | 성공 + 학생 정보 반환 |
| AUTH-05 | 비밀번호 오류 | `login("20210001", "wrongpw")` 호출 | 실패, 에러 메시지 |
| AUTH-06 | 로그인 실패 잠금 | 동일 학번으로 5회 연속 실패 후 재시도 | 6번째에서 "10분 후 재시도" 메시지 |
| AUTH-07 | 관리자 로그인 (설정된 비밀번호) | `admin_login("prof2026!")` 호출 | 성공 |
| AUTH-08 | 관리자 비밀번호 오류 | `admin_login("wrong")` 호출 | 실패 |
| AUTH-09 | 비밀번호 해싱 확인 | 20210001의 비밀번호 셀 직접 읽기 | 평문이 아닌 해시 문자열이어야 함 |
| AUTH-10 | **초기 비밀번호 로그인** | admin_password 빈 값일 때 `admin_login("minsuk615")` 호출 | 성공 + `needPasswordChange: true` |
| AUTH-11 | **초기 비밀번호 오류** | admin_password 빈 값일 때 `admin_login("wrong")` 호출 | 실패 |
| AUTH-12 | **교수 비밀번호 변경** | `change_admin_password("minsuk615", "newpass2026!")` 호출 | 성공, 시트에 새 해시 저장 |
| AUTH-13 | **변경된 비밀번호로 로그인** | `admin_login("newpass2026!")` 호출 | 성공, `needPasswordChange: false` |

#### 16.1.2 과목 관리 테스트 (v2.0 신규)

| 테스트 ID | 테스트명 | 절차 | 기대 결과 |
|-----------|---------|------|----------|
| COURSE-01 | **과목 생성** | `create_course("소프트웨어공학개론", 2026, "1")` | 스프레드시트 "CrossEval-2026-1-소프트웨어공학개론" 생성 |
| COURSE-02 | **시트 자동 생성 확인** | COURSE-01 후 스프레드시트 내부 확인 | `_config`, `학생_마스터`, `과제_목록` 시트 존재 |
| COURSE-03 | **과목 목록 등록 확인** | 마스터 스프레드시트의 `과목_목록` 확인 | C1 레코드 존재, 스프레드시트ID 포함 |
| COURSE-04 | **두 번째 과목 생성** | `create_course("데이터베이스설계", 2026, "1")` | 별도 스프레드시트 생성, 과목_목록에 C2 추가 |
| COURSE-05 | **과목 목록 조회** | `get_courses_list()` 호출 | 2개 과목 반환 |
| COURSE-06 | **_config 내용 확인** | 과목1 스프레드시트의 _config 읽기 | course_name, year, semester 정확 |

#### 16.1.3 학생 등록 테스트 (v2.0 변경)

| 테스트 ID | 테스트명 | 절차 | 기대 결과 |
|-----------|---------|------|----------|
| REG-01 | **학생 일괄 등록** | 과목1에 8명 학생 JSON 배열 등록 | 학생_마스터에 8행, 학번+이름만 |
| REG-02 | **중복 등록 방지** | 동일 학번으로 다시 등록 시도 | 기존 데이터 유지, 중복 스킵 |
| REG-03 | **과목2 학생 등록** | 과목2에 5명 학생 등록 | 과목2 학생_마스터에 5행 |
| REG-04 | **다중 과목 학생 확인** | 20210001이 두 과목에 모두 등록되었는지 확인 | 두 시트 모두에 존재 |
| REG-05 | **학생 목록 조회** | `get_students_list(courseId)` 호출 | 해당 과목의 학생만 반환 |
| REG-06 | **학생 제거** | `remove_student(courseId, "20210008")` 호출 | 학생_마스터에서 20210008 행 삭제, 성공 반환 |
| REG-07 | **제거 후 목록 확인** | `get_students_list(courseId)` 호출 | 20210008 미포함, 7명만 반환 |
| REG-08 | **제거된 학생 로그인** | 20210008로 해당 과목 과제 조회 | 해당 과목 과제 비표시 |
| REG-09 | **미등록 학생 제거 시도** | `remove_student(courseId, "99999999")` 호출 | 실패, "등록되지 않은 학번" 에러 |

#### 16.1.4 과제 관리 테스트

| 테스트 ID | 테스트명 | 절차 | 기대 결과 |
|-----------|---------|------|----------|
| ASGN-01 | 과제 생성 | `create_assignment(courseId, {name:"UML 클래스 다이어그램 작성", ...})` | 과제_목록에 행 추가, 제출_A1/평가_A1 시트 생성 |
| ASGN-02 | 시트 자동 생성 확인 | ASGN-01 후 시트 목록 조회 | "제출_A1", "평가_A1" 시트 존재 |
| ASGN-03 | **과제 상태 확인** | 과제_목록에서 과제1 조회 | **상태 = "제출중"** (v2.0: 즉시 제출중) |
| ASGN-04 | 두 번째 과제 생성 | 과제2 생성 | 과제_목록에 2행, 제출_A2/평가_A2 시트 생성 |
| ASGN-05 | **다른 과목에 과제 생성** | 과목2에 과제1 생성 | 과목2 스프레드시트에 시트 생성 |

#### 16.1.5 과제 제출 테스트 (v2.0 신규)

| 테스트 ID | 테스트명 | 절차 | 기대 결과 |
|-----------|---------|------|----------|
| SUB-01 | **정상 링크 제출** | `submit_assignment(studentId, courseId, assignmentId, link)` | 제출_A1에 행 추가 |
| SUB-02 | **중복 제출 (덮어쓰기)** | 동일 학번으로 다른 링크 제출 | 기존 행이 새 링크로 업데이트 |
| SUB-03 | **제출 데이터 삽입** | 테스트 데이터 7명 제출 | 제출_A1에 7행 |
| SUB-04 | **미제출자 확인** | 학생_마스터 대비 미제출 학번 추출 | [20210008] |
| SUB-05 | **제출 정보 조회** | `get_submission(studentId, courseId, assignmentId)` | 제출 링크 + 시각 반환 |
| SUB-06 | **미제출자 제출 조회** | 20210008의 제출 조회 | 제출 없음 반환 |
| SUB-07 | **평가중 상태에서 제출 시도** | 상태가 "평가중"일 때 제출 | 거부 |

#### 16.1.6 평가 배정 알고리즘 테스트

| 테스트 ID | 테스트명 | 절차 | 기대 결과 |
|-----------|---------|------|----------|
| ASSIGN-01 | 기본 배정 (7명) | `assignEvaluators([20210001,...,20210007])` | 7개 배정 결과, **각 3명** |
| ASSIGN-02 | 자기 자신 배제 | 모든 배정 결과 검증 | 어떤 학생도 자기 자신을 평가하지 않음 |
| ASSIGN-03 | 평가 횟수 검증 | 각 학생의 평가 대상 수 카운트 | 모든 학생이 정확히 **3명**을 평가 |
| ASSIGN-04 | 피평가 횟수 검증 | 각 학생이 평가받는 횟수 카운트 | 모든 학생이 정확히 **3회** 평가받음 |
| ASSIGN-05 | 최소 인원 거부 | `assignEvaluators([20210001, 20210002])` (2명) | 에러: "최소 3명 이상" |
| ASSIGN-06 | **3명 경계값 (2명 배정)** | `assignEvaluators([s1, s2, s3])` | 정상 배정, **각 2명씩**, 자기 자신 배제 확인 |
| ASSIGN-07 | **4명 경계값 (3명 배정)** | `assignEvaluators([s1, s2, s3, s4])` | 정상 배정, **각 3명씩** |
| ASSIGN-08 | 대규모 (50명) | 가상 50명 학번 생성 후 실행 | 위 조건 모두 충족, 각 3명씩 |
| ASSIGN-09 | 랜덤성 확인 | 동일 입력으로 2회 실행 | 결과가 다름 (셔플 때문) |
| ASSIGN-10 | 고정 시드 재현성 | 테스트 모드에서 고정 시드로 2회 실행 | 결과가 동일 |

#### 16.1.7 평가 제출 테스트

| 테스트 ID | 테스트명 | 절차 | 기대 결과 |
|-----------|---------|------|----------|
| EVAL-01 | 정상 평가 제출 | 20210003이 학생1(20210006)에게 78점 + 서술평 제출 | 평가_A1 시트에 점수/서술평/시각 기록 |
| EVAL-02 | 범위 초과 점수 | 점수 = 150 (최대 100) 제출 시도 | 거부, 에러 메시지 |
| EVAL-03 | 음수 점수 | 점수 = -10 제출 시도 | 거부 |
| EVAL-04 | 소수점 점수 | 점수 = 85.5 제출 시도 | 거부 (정수만 허용) |
| EVAL-05 | 서술평 미달 | 서술평 10자 제출 시도 | 거부 (최소 20자) |
| EVAL-06 | 배정되지 않은 대상 평가 | 20210003이 배정되지 않은 학생을 평가 시도 | 거부 (권한 없음) |
| EVAL-07 | 자기 자신 평가 시도 | 20210003이 20210003을 평가 시도 | 거부 |
| EVAL-08 | 미제출자 평가 시도 | 20210008이 평가 시도 | 거부 (과제 미제출) |
| EVAL-09 | 평가 수정 | EVAL-01 후 동일 대상에 점수 변경 | 기존 기록 업데이트 |
| EVAL-10 | 마감 후 제출 | 평가마감일시 이후 제출 시도 | 거부 (테스트 모드 해제 후) |
| EVAL-11 | **익명 인덱스 기반 제출** | targetIndex=0으로 제출 | 배정된 첫 번째 대상에 기록 |

#### 16.1.8 결과 집계 테스트

| 테스트 ID | 테스트명 | 절차 | 기대 결과 |
|-----------|---------|------|----------|
| RESULT-01 | 평가 종료 | 모든 테스트 평가 입력 후 `end_evaluation` | 과제 상태 → "평가완료" |
| RESULT-02 | 받은 점수 정확성 | 20210001의 받은 점수 확인 | 85, 82, 84 (3명에게 받음) |
| RESULT-03 | 교수 평가 입력 | 7명 모두 교수 점수 입력 | 평가_A1에 교수 점수/서술평 기록 |
| RESULT-04 | 과제 확정 | `finalize_assignment` | 상태 = "확정" |
| RESULT-05 | 학생 결과 조회 | `get_my_results("20210001")` | 받은 점수 3개 + 서술평 3개 + 교수 평가, **평가자 학번 미포함** |
| RESULT-06 | 미평가자 목록 | 일부 평가 미입력 상태에서 종료 | 미완료자 목록 정확히 반환 |
| RESULT-07 | **2명 평가 결과 (3명 경계)** | 과제3(3명 제출) 결과 조회 | 평가자3 영역 빈 값, 2개 점수만 반환 |

#### 16.1.9 보안 테스트

| 테스트 ID | 테스트명 | 절차 | 기대 결과 |
|-----------|---------|------|----------|
| SEC-01 | 타인 결과 조회 시도 | 20210001 인증으로 20210002 결과 조회 시도 | 거부 또는 20210001 결과만 반환 |
| SEC-02 | 학생이 교수 API 호출 | 학생 인증으로 `create_assignment` 호출 | 거부 |
| SEC-03 | 인증 없이 API 호출 | 학번/비밀번호 없이 `get_my_results` 호출 | 거부 |
| SEC-04 | 다른 학생 평가 위조 | 20210001 인증으로 20210003의 평가 수정 시도 | 거부 |
| SEC-05 | **결과에 평가자 비노출** | `get_my_results` 응답 검사 | 응답 JSON에 평가자 학번 필드 없음 |
| SEC-06 | **평가 대상 익명성** | `get_evaluation_targets` 응답 검사 | 응답에 피평가자 학번/이름 없음, "학생1" 등 라벨만 |
| SEC-07 | **다른 과목 접근 시도** | 과목1에만 등록된 학생이 과목2 데이터 접근 | 거부 |

#### 16.1.10 다회차 과제 테스트

| 테스트 ID | 테스트명 | 절차 | 기대 결과 |
|-----------|---------|------|----------|
| MULTI-01 | 2번째 과제 전체 플로우 | 과제2 생성→제출(5명)→배정→평가→종료→확정 | 전 과정 정상 완료, **3명씩 배정** |
| MULTI-02 | 학생_마스터 다중 열 | 과제1+과제2 확정 후 마스터 시트 확인 | 과제1_최종점수, 과제2_최종점수 열 모두 존재 |
| MULTI-03 | 과제2 미제출자 분리 | 과제2 결과 조회 | 20210004, 20210006, 20210008은 결과 없음, 과제1 결과는 유지 |
| MULTI-04 | **3명 제출 과제 (2명 배정)** | 과제3 생성→제출(3명)→배정→평가→확정 | 2명씩 배정, 평가자3 빈 값 |

#### 16.1.11 다중 과목 테스트 (v2.0 신규)

| 테스트 ID | 테스트명 | 절차 | 기대 결과 |
|-----------|---------|------|----------|
| MCOURSE-01 | **과목2 전체 플로우** | 과목2에서 과제 생성→학생 등록→제출→배정→평가→확정 | 과목2 스프레드시트에서 전 과정 정상 |
| MCOURSE-02 | **학생 다중 과목 과제 목록** | 20210001로 `get_my_assignments` 호출 | 과목1 + 과목2의 과제 모두 반환 |
| MCOURSE-03 | **과목 간 데이터 격리** | 과목1의 과제 결과가 과목2에 영향 없는지 확인 | 각 과목 독립적 |
| MCOURSE-04 | **과목 간 비밀번호 공유** | 과목1에서 설정한 비밀번호로 과목2 접근 | 비밀번호는 공유됨 (동일 학번) |

### 16.2 수동 테스트 (자동화 불가 항목)

아래 항목들은 브라우저 환경, UI 인터랙션 등이 포함되어 자동 테스트가 어렵다. **사람이 직접 브라우저에서 수행**해야 한다.

#### 16.2.1 프론트엔드 UI 테스트

| 테스트 ID | 테스트명 | 수동 절차 | 확인 사항 |
|-----------|---------|----------|----------|
| MAN-UI-01 | 최초 로그인 흐름 | 20210001로 학번 입력 → 비밀번호 설정 화면 표시 확인 → 비밀번호 입력 → 대시보드 이동 | 화면 전환이 자연스러운지, 에러 메시지가 적절한지 |
| MAN-UI-02 | 재로그인 흐름 | 탭 닫고 재접속 → 학번 + 비밀번호 입력 | 정상 로그인 후 대시보드 표시 |
| MAN-UI-03 | **교수 초기 로그인** | 교수 탭 → `minsuk615` 입력 | 비밀번호 변경 화면 강제 이동 |
| MAN-UI-04 | **교수 비밀번호 변경** | 새 비밀번호 입력 → 저장 → 재로그인 | 새 비밀번호로만 로그인 가능 |
| MAN-UI-05 | **과목 생성 화면** | 교수 로그인 → "새 과목 만들기" → 정보 입력 → 생성 | 과목 카드가 목록에 추가 |
| MAN-UI-06 | **과목 선택 화면** | 생성된 과목 카드 클릭 | 해당 과목 대시보드로 이동, 상단에 과목명 표시 |
| MAN-UI-07 | **엑셀 업로드 UI** | 학생 관리 탭 → 엑셀 파일 드래그앤드롭 또는 선택 | 미리보기 테이블 정상 표시, 등록 성공 |
| MAN-UI-08 | **학생 제거 UI** | 학생 관리 탭 → 학생 행의 "삭제" 버튼 클릭 → 확인 모달 → 확인 | 학생 목록에서 제거, 목록 갱신 |
| MAN-UI-08a | **과제 제출 UI** | 학생 로그인 → 제출중 과제 → 링크 입력 → 제출 | 공유 안내 메시지 표시, 제출 성공, 재접속 시 기존 링크 표시 |
| MAN-UI-09 | **익명 평가 화면** | 학생 로그인 → 평가중 과제 → 피평가자 목록 확인 | "학생1", "학생2" 등으로만 표시, 실명 비공개 |
| MAN-UI-10 | **개별 평가 수행** | 학생1 클릭 → 제출 링크 + 평가 기준 확인 → 점수/서술평 입력 → 완료 | 링크 새 탭 열림, 입력 후 "학생1(완료)" 표시 |
| MAN-UI-11 | **평가 수정** | 완료된 학생 다시 클릭 → 이전 값 표시 → 수정 → 저장 | 수정된 값으로 업데이트 |
| MAN-UI-12 | **결과 확인 화면** | 확정된 과제 → 결과 보기 | 평가자1/2/3 점수+서술평, 교수 평가, **평가자 이름/학번 비공개** |
| MAN-UI-13 | **2명 평가 결과 표시** | 3명 제출 과제 결과 확인 | 평가자3 영역 미표시 |
| MAN-UI-14 | **다중 과목 대시보드** | 두 과목 모두 등록된 학생으로 로그인 | 두 과목의 과제가 모두 표시, 과목명 태그 확인 |
| MAN-UI-15 | 점수 입력 유효성 | 범위 밖 점수, 소수점, 빈칸 등 입력 시도 | 프론트엔드 즉시 경고 표시 |
| MAN-UI-16 | 서술평 글자수 카운터 | 서술평 textarea에 입력하면서 글자수 표시 확인 | 실시간 카운트, 20자 미만 시 제출 버튼 비활성화 |
| MAN-UI-17 | 모바일 반응형 | 모바일 브라우저(또는 DevTools 모바일 뷰)에서 접속 | 레이아웃이 깨지지 않고, 터치로 조작 가능한지 |
| MAN-UI-18 | 세션 만료 | sessionStorage 삭제 후 보호된 페이지 접근 | 로그인 페이지로 리다이렉트 |
| MAN-UI-19 | **상호평가 시작 (마감 전)** | 교수 화면에서 제출마감 전에 "상호평가 시작" 클릭 | 정상 실행, 이후 학생 추가 제출 불가 확인 |

#### 16.2.2 CORS 및 네트워크 테스트

| 테스트 ID | 테스트명 | 수동 절차 | 확인 사항 |
|-----------|---------|----------|----------|
| MAN-NET-01 | GitHub Pages→Apps Script 통신 | 배포된 GitHub Pages에서 로그인 시도 | 브라우저 콘솔에 CORS 에러 없이 응답 수신 |
| MAN-NET-02 | 네트워크 지연 처리 | 브라우저 DevTools에서 Slow 3G로 변경 후 조작 | 로딩 인디케이터 표시, 타임아웃 메시지 |
| MAN-NET-03 | Apps Script 배포 URL 변경 | 새 버전으로 재배포 후 프론트엔드 호출 | 새 URL이 정상 작동 |

#### 16.2.3 동시 접속 테스트

| 테스트 ID | 테스트명 | 수동 절차 | 확인 사항 |
|-----------|---------|----------|----------|
| MAN-CONC-01 | 동시 평가 제출 | 2개 브라우저에서 서로 다른 학생으로 동시 평가 제출 | 두 건 모두 정상 저장, 데이터 충돌 없음 |
| MAN-CONC-02 | 동시 로그인 | 동일 학번으로 2개 탭에서 동시 로그인 | 두 탭 모두 정상 작동 |

#### 16.2.4 엔드-투-엔드(E2E) 시나리오 테스트

전체 학기 시나리오를 **한 번에 처음부터 끝까지** 수동으로 수행한다.

```
E2E 테스트 시나리오 (예상 소요시간: 60~90분)

[준비]
1. initTestData() 실행 → 마스터 시트 초기화, 교수 비밀번호 빈 값 확인

[교수 초기 설정]
2. 교수 로그인: 'minsuk615' → 비밀번호 변경 강제 → 새 비밀번호 설정
3. 새 비밀번호로 재로그인 확인

[과목 생성]
4. "소프트웨어공학개론" 과목 생성 → 스프레드시트 자동 생성 확인
5. "데이터베이스설계" 과목 생성

[학생 등록]
6. 과목1에 엑셀 파일로 8명 등록 → 미리보기 → 등록 확인
7. 과목2에 5명 등록

[과제 1 사이클 - 과목1]
8. 교수: 과제1 생성 → 상태 = "제출중" 확인
9. 학생 1(20210001): 로그인(최초 비밀번호 설정) → 과제 링크 제출
10. 학생 2~7: 각각 로그인 → 과제 링크 제출
11. 교수: "상호평가 시작" (마감 전에 클릭 가능한지 확인) → 3명씩 배정 확인
12. 학생 1: 대시보드에서 "학생1", "학생2", "학생3" 버튼 확인 (익명)
13. 학생 1: 학생1 클릭 → 링크 + 채점기준 확인 → 점수/서술평 입력 → 완료
14. 학생 1: "학생1(완료)" 표시 확인 → 다시 클릭 → 수정 가능 확인
15. 학생 2~7: 각각 평가 수행
16. 교수: 평가 현황 확인 → 7/7 완료
17. 교수: "평가 종료" → 교수 평가 7명 입력
18. 교수: "확정"
19. 학생 1: 결과 확인 → 평가자1/2/3 점수+서술평 + 교수 평가 표시
20. 학생 1: 평가자 이름/학번이 보이지 않는 것 확인

[과제 2 사이클 - 과목1]
21. 교수: 과제2 생성
22. 5명만 제출 (20210004, 20210006, 20210008 미제출)
23. 교수: "상호평가 시작" → 5명만 3명씩 배정 확인
24. 학생 5명 평가 수행
25. 교수: 종료 → 교수 평가 → 확정

[과제 3 사이클 - 과목1 (3명 경계)]
26. 교수: 과제3 생성
27. 3명만 제출
28. 교수: "상호평가 시작" → 3명 × 2명 배정 확인
29. 학생 3명 평가 수행
30. 결과 확인: 평가자3 영역 미표시 확인

[과목2 사이클]
31. 과목2 선택 → 과제1 생성
32. 5명 제출 → 상호평가 → 확정
33. 20210001로 로그인 → 과목1 + 과목2 과제 모두 표시 확인

[결과 검증]
34. 과목1 학생_마스터 시트: 과제1, 과제2, 과제3 최종점수 열 확인
35. 과목2 학생_마스터 시트: 과제1 최종점수 열 확인
36. 미제출자의 해당 과제 점수 열이 빈칸인지 확인
```

### 16.3 테스트 결과 기록

#### `_test_log` 시트 구조

| 열 | 필드명 | 설명 |
|----|--------|------|
| A | 실행일시 | |
| B | 테스트ID | AUTH-01, COURSE-01, EVAL-03 등 |
| C | 테스트명 | |
| D | 결과 | PASS / FAIL |
| E | 상세 | 실패 시 에러 메시지 |
| F | 실행시간(ms) | |

자동 테스트는 `runAllTests()` 실행 시 이 시트에 자동 기록된다.
수동 테스트는 테스터가 실행 후 이 시트에 수동으로 결과를 기입한다.

### 16.4 테스트 자동화 한계 정리

| 영역 | 자동화 가능 | 수동 필수 | 이유 |
|------|:----------:|:---------:|------|
| API 로직 (인증, CRUD, 배정) | ✅ | | Apps Script 내에서 직접 호출 가능 |
| 데이터 무결성 검증 | ✅ | | 시트 데이터 직접 읽기/비교 |
| 보안 규칙 (권한 검증) | ✅ | | API 파라미터 조작 후 검증 |
| 알고리즘 정확성 | ✅ | | 수학적 검증 가능 |
| 과목 생성/관리 | ✅ | | SpreadsheetApp API로 검증 |
| 익명성 검증 | ✅ | | API 응답 필드 검사 |
| 브라우저 UI 렌더링 | | ✅ | HTML/CSS 시각적 확인 필요 |
| 엑셀 파일 업로드/파싱 | | ✅ | 프론트엔드 파일 API 필요 |
| CORS 동작 | | ✅ | 실제 cross-origin 환경 필요 |
| 동시 접속 | | ✅ | 멀티 브라우저 세션 필요 |
| 모바일 반응형 | | ✅ | 실제 기기/뷰포트 확인 |
| 사용자 경험 (UX) | | ✅ | 주관적 판단 필요 |

### 16.5 테스트 수량 요약

| 카테고리 | 테스트 수 |
|---------|---------|
| AUTH (인증) | 13 |
| COURSE (과목 관리) | 6 |
| REG (학생 등록) | 5 |
| ASGN (과제 관리) | 5 |
| SUB (과제 제출) | 7 |
| ASSIGN (평가 배정) | 10 |
| EVAL (평가 제출) | 11 |
| RESULT (결과 집계) | 7 |
| SEC (보안) | 7 |
| MULTI (다회차) | 4 |
| MCOURSE (다중 과목) | 4 |
| **자동 테스트 합계** | **79** |
| MAN-UI (UI) | 19 |
| MAN-NET (네트워크) | 3 |
| MAN-CONC (동시 접속) | 2 |
| E2E (시나리오) | 1 |
| **수동 테스트 합계** | **25** |
| **전체 합계** | **104** |
